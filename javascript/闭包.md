### 概念
可以访问其他函数内部变量的函数

### 执行上下文（执行环境）
* 全局环境
* 函数环境
* Eval环境

### 执行上下文
* 创建阶段
  * 作用域链（当前变量对象+所有父级变量对象）
  * 变量对象（参数、变量、函数声明）
  * this
* 执行阶段
  * 变量赋值
  * 函数引用等

每新建一层都会包含前面那层的变量对象
匿名函数创建自己的执行上下文，会创建相应的作用域链和变量对象

闭包 🌰
```js
function books () {
  var book = '书'
  return function () {
    consolg.log(book)
  }
}
var bag = books()
bag()
```
* 创建全局环境：
  * 作用域链：全局变量对象
  * 变量对象：books，bag
* books函数执行上下文：
  * 作用域链：全局变量对象+books变量对象
  * 变量对象：book，
* 匿名函数执行上下文：
  * 作用域链：匿名函数变量对象 + books变量对象 + 全局变量对象
  * 变量对象：

### 经典面试题 🥕
```js
for (var i = 0; i < 5; i++) {
  setTimeout(() => {
    console.log(i++)
  }, 4000)
}
console.log(i)
```
执行顺序：
1. 创建全局环境，进入for循环
2. 遇到setTimeout，将i++放入任务队列；直到循环结束，此时任务队列中的任务有：i++ i++ i++ i++ i++
3. 执行console.log(i),输出5
4. 宏任务执行完毕，执行任务队列中任务
5. 4秒后输出5 6 7 8 9

 
```js
for (var i = 0; i < 5; i++) {
  (function (x) {
    setTimeout(() => {
      console.log(x++)
    }, 4000)
  })(i)
}
console.log(i)
```


### 词法作用域
一个函数可以访问调用上下文中定义的变量